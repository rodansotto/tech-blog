<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Key Points To Architecturing Cloud Applications, Part 3: Performance | Rodan Sotto’s Tech Blog</title>
<meta name="generator" content="Jekyll v3.9.2">
<meta property="og:title" content="Key Points To Architecturing Cloud Applications, Part 3: Performance">
<meta property="og:locale" content="en_US">
<meta name="description" content="A software developer’s personal notes">
<meta property="og:description" content="A software developer’s personal notes">
<link rel="canonical" href="https://rodansotto.github.io/tech-blog/2023/01/16/key-points-to-arch-cloud-app-perf.html">
<meta property="og:url" content="https://rodansotto.github.io/tech-blog/2023/01/16/key-points-to-arch-cloud-app-perf.html">
<meta property="og:site_name" content="Rodan Sotto’s Tech Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-01-16T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Key Points To Architecturing Cloud Applications, Part 3: Performance">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-16T00:00:00+00:00","datePublished":"2023-01-16T00:00:00+00:00","description":"A software developer’s personal notes","headline":"Key Points To Architecturing Cloud Applications, Part 3: Performance","mainEntityOfPage":{"@type":"WebPage","@id":"https://rodansotto.github.io/tech-blog/2023/01/16/key-points-to-arch-cloud-app-perf.html"},"url":"https://rodansotto.github.io/tech-blog/2023/01/16/key-points-to-arch-cloud-app-perf.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/tech-blog/assets/css/main.css">
  <script src="/tech-blog/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="https://rodansotto.github.io/tech-blog/feed.xml" title="Rodan Sotto's Tech Blog">
<!--<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">-->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs tpbg ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }

  .tpbg {
    background: transparent;
  }
</style>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/tech-blog/">
  <img class="site-favicon" title="Rodan Sotto's Tech Blog" src="" onerror="this.style.display='none'">
  Rodan Sotto's Tech Blog
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/tech-blog/">HOME</a><a class="page-link" href="/tech-blog/archives.html">ARCHIVES</a><a class="page-link" href="/tech-blog/categories.html">CATEGORIES</a><a class="page-link" href="/tech-blog/search2.html">SEARCH</a>




</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Key Points To Architecturing Cloud Applications, Part 3: Performance</h1>
  <h2 class="post-subtitle"></h2>

  <p class="post-meta">
    <time class="dt-published" datetime="2023-01-16T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Jan 16, 2023
    </time>

    
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 8 mins</span>
  </p></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <p><img src="/tech-blog/assets/images/cloud-perf.png" alt=""></p>

<p>These are key points from the course I took recently on <a href="https://learn.microsoft.com/en-us/training/paths/azure-well-architected-framework/">Build great solutions with the Microsoft Azure Well-Architected Framework</a>.  I think these points are applicable no matter which cloud provider you use.  This will be a 5-part series on cost, operations, performance, reliability and security considerations in architecturing cloud applications.</p>

<p>Here are the links to the other parts:</p>
<ul>
  <li><a href="/tech-blog/2022/12/14/key-points-to-arch-cloud-app-cost.html">Part 1: Cost</a></li>
  <li><a href="/tech-blog/2022/12/16/key-points-to-arch-cloud-app-ops.html">Part 2: Operations</a></li>
  <li><a href="/tech-blog/2023/01/30/key-points-to-arch-cloud-app-reliab.html">Part 4: Reliability</a></li>
</ul>

<p></p>
<p><strong>This is Part 3: Performance</strong> and below are the key points to ensure your cloud architecture is performing at its best thus providing users with the best experience.</p>

<h2 id="use-scaling-up-and-scaling-out-in-your-architecture">Use scaling up and scaling out in your architecture</h2>

<p>Scaling resources allows your application to meet demands in times of increased load and provides you cost savings during off peak times.  Scaling in the cloud is usually easier than scaling on-premises and this is one of those main reasons of moving into the cloud.</p>

<h3 id="scaling-up-or-down">Scaling up or down</h3>

<ul>
  <li>
    <p>When scaling resources for a single instance of a service, such as a virtual machine, you scale up or down</p>
  </li>
  <li>
    <p>You increase or decrease the number of resources in a service, such as the cpu capacity, memory capacity, or storage capacity</p>
  </li>
  <li>
    <p>Example of a cloud service that can be scaled up or down would be a virtual machine, a database service (to increase/decrease database transaction units for example), or an application service.</p>
  </li>
</ul>

<h3 id="scaling-out-or-in">Scaling out or in</h3>

<ul>
  <li>
    <p>With scaling out and in, the number of instances are adjusted</p>
  </li>
  <li>
    <p>In the infrastructure layer, you can increase and decrease the number of VM instances</p>
  </li>
  <li>
    <p>In a database, you can employ a sharding technique that splits a large database into multiple smaller database and deployed across multiple servers</p>
  </li>
  <li>
    <p>In an application service, if setup in an application farm, you can increase and decrease the number of VMs in the farm.</p>
  </li>
</ul>

<h3 id="autoscaling">Autoscaling</h3>

<p>If available, autoscaling allows you to scale your services automatically based on specific metrics like CPU utilization or queue length or schedule.</p>

<h3 id="considerations-when-scaling">Considerations when scaling</h3>

<ul>
  <li>
    <p>Startup time of your application can impact how quickly your application can scale</p>

    <ul>
      <li>You might want to add a lead time when scaling</li>
    </ul>
  </li>
</ul>

<p></p>
<ul>
  <li>
    <p>How your application handles state</p>

    <ul>
      <li>
        <p>If an instance is removed the state stored there is lost</p>
      </li>
      <li>
        <p>If an instance is added the state from another instance does not have its state</p>
      </li>
      <li>
        <p>Best to externalize the state to another service such as Redis or a database</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="throttling">Throttling</h3>

<ul>
  <li>
    <p>Sometimes the load on an application is caused by the number of active or concurrent users and the activities being performed</p>
  </li>
  <li>
    <p>Throttling limits the number of requests from a source and this is one way to prevent the application from breaking</p>
  </li>
  <li>
    <p>Used most frequently in applications that expose API endpoints</p>
  </li>
</ul>

<h3 id="serverless">Serverless</h3>

<ul>
  <li>
    <p>Serverless computing provides a cloud-hosted execution environment that runs your apps/code, but completely abstracts the underlying environment</p>
  </li>
  <li>
    <p>You configure your serverless apps to respond to events</p>
  </li>
  <li>
    <p>Infrastructure isn’t your responsibility</p>
  </li>
  <li>
    <p>Scaling and performance are handled automatically</p>
  </li>
  <li>
    <p>Example of serverless computing is the Azure Functions/AWS Lambda/GCP Cloud Functions</p>
  </li>
</ul>

<h3 id="containers">Containers</h3>

<ul>
  <li>
    <p>A container is a method of running applications in a virtualized environment at the OS level</p>
  </li>
  <li>
    <p>Containers are lightweight and well suited to scale-out scenarios</p>
  </li>
  <li>
    <p>They’re designed to be created, scaled out, and stopped dynamically as your environment and demands change</p>
  </li>
  <li>
    <p>With containers, you don’t necessarily need to separate VMs for separate workloads</p>
  </li>
  <li>
    <p>Some services that ease the management and scaling of containers</p>

    <ul>
      <li>
        <p>Kubernetes Service</p>
      </li>
      <li>
        <p>Cloud specific container management service</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="optimize-network-performance">Optimize network performance</h2>

<h3 id="network-latency">Network latency</h3>

<ul>
  <li>
    <p>Network latency is the time that it takes for data to travel between a source to a destination across a network</p>
  </li>
  <li>
    <p>To improve network performance, we must strive to reduce network latency</p>
  </li>
</ul>

<h3 id="latency-between-cloud-resources">Latency between cloud resources</h3>

<ul>
  <li>
    <p>Create read-replica of databases in different regions</p>
  </li>
  <li>
    <p>Sync your data between regions</p>
  </li>
  <li>
    <p>Use a globally distributed database</p>
  </li>
  <li>
    <p>Use a caching technology such as Redis</p>
  </li>
</ul>

<h3 id="latency-between-users-and-cloud-resources">Latency between users and cloud resources</h3>

<ul>
  <li>
    <p>Use a DNS load balancer for endpoint path optimization</p>

    <ul>
      <li>
        <p>Can distribute traffic within and across regions</p>
      </li>
      <li>
        <p>Can route users based on a set of criteria:</p>
        <ul>
          <li>Priority</li>
          <li>Weighted</li>
          <li>Performance (based on network latency)</li>
          <li>Geographic</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p></p>
<ul>
  <li>
    <p>Use a CDN to cache content close to users</p>

    <ul>
      <li>
        <p>Using a content delivery network (CDN) can deliver static content such as website pages or image and video assets to users faster</p>
      </li>
      <li>
        <p>You can use CDN to host cached dynamic content but you will need to manage content expiration by setting a time to live (TTL)</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Use a connectivity service from on-premises to cloud provider</p>

    <ul>
      <li>
        <p>Optimizing network connectivity from your on-premises environment to cloud is also important</p>
      </li>
      <li>
        <p>Internet connection or even site-to-site VPN over the internet might have an impact on network latency for high-throughput architecture</p>
      </li>
      <li>
        <p>A private dedicated connection between your network and the cloud can give a guaranteed performance</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="optimize-storage-performance">Optimize storage performance</h2>

<h3 id="optimize-virtual-machine-storage-performance">Optimize virtual machine storage performance</h3>

<ul>
  <li>
    <p>Some disk options that your cloud provider might provide:</p>

    <ul>
      <li>
        <p>Local SSD storage that is included in VM and is local, thus has a high performance but could be lost during maintenance event or a redeployment of the VM</p>
      </li>
      <li>
        <p>Standard storage HDD that is only HDD and only good for dev/test workload</p>
      </li>
      <li>
        <p>Standard storage SSD that has a low latency of an SSD but only good enough for non production use</p>
      </li>
      <li>
        <p>Premium storage SSD that is well suited for those workloads that are going into production</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Another way to optimize storage performance is to use a striping technology that spreads disk activity across multiple disks; often seen in high-performance database systems</p>
  </li>
</ul>

<h3 id="optimize-storage-performance-for-your-application">Optimize storage performance for your application</h3>

<ul>
  <li>
    <p>Caching</p>

    <ul>
      <li>Integrate a caching layer between your application and your data store</li>
    </ul>
  </li>
</ul>

<p></p>
<ul>
  <li>
    <p>Polyglot persistence</p>

    <ul>
      <li>
        <p>Use different data storage technologies such as blob store for your application assets, NoSQL store for user related or created data, and a SQL database for your account data (for example)</p>
      </li>
      <li>
        <p>With polyglot persistence, maintaining data consistency can be a significant challenge</p>
      </li>
      <li>
        <p>A more relaxed approach to consistency is used and is known as eventual consistency</p>
      </li>
      <li>
        <p>Eventual consistency means that replica data stores eventually converge if there are no further writes</p>
      </li>
    </ul>
  </li>
</ul>

<h2 id="identify-performance-bottlenecks-in-your-application">Identify performance bottlenecks in your application</h2>

<h3 id="performance-requirements">Performance requirements</h3>

<ul>
  <li>
    <p>Without performance requirements defined, you could keep improving further and further without end to the point that it becomes prohibitively expensive, difficult, and doesn’t have enough business impact to be worthwhile</p>
  </li>
  <li>
    <p>Nonfunctional requirements help you find that point; doesn’t tell you what your app must do but tell you what quality levels it must meet</p>
  </li>
  <li>
    <p>You should discuss requirements with your stakeholders or customers, document them, and communicate them broadly to ensure that everyone agrees on what good performance means</p>
  </li>
</ul>

<h3 id="performance-monitoring-options-in-the-cloud">Performance monitoring options in the cloud</h3>

<ul>
  <li>
    <p>Infrastructure-level logging and monitoring service that can collect following data:</p>

    <ul>
      <li>
        <p>Application monitoring data, which is the data about the performance and functionality of the code you’ve written</p>
      </li>
      <li>
        <p>Guest OS monitoring data</p>
      </li>
      <li>
        <p>Resource monitoring data, which is the data about the operation of a cloud resource</p>
      </li>
      <li>
        <p>Subscription monitoring data (if available)</p>
      </li>
      <li>
        <p>Tenant monitoring data (if available)</p>
      </li>
    </ul>
  </li>
</ul>

<p></p>
<ul>
  <li>
    <p>Log analytics tool</p>

    <ul>
      <li>
        <p>Centralized logging</p>
      </li>
      <li>
        <p>You can query and aggregate data across logs</p>
      </li>
    </ul>
  </li>
</ul>

<p></p>
<ul>
  <li>
    <p>Application performance management</p>

    <ul>
      <li>Using an APM solution to gain a deep understanding of your application and to correlate activity across your application</li>
    </ul>
  </li>
</ul>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/tech-blog/2022/12/16/key-points-to-arch-cloud-app-ops.html" title="Key Points To Architecturing Cloud Applications, Part 2: Operations">Key Points To Architecturing Cloud Applications,...</a><a class="next" href="/tech-blog/2023/01/30/key-points-to-arch-cloud-app-reliab.html" title="Key Points To Architecturing Cloud Applications, Part 4: Reliability">Key Points To Architecturing Cloud Applications,...</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/tech-blog/2017/11/07/dont-confuse-dip-ioc-and-di-together-they-are-all-different-but-related.html" title="Key Points To Architecturing Cloud Applications, Part 4: Reliability">Don't confuse DIP, IoC, and DI together. They are all different but...</a></li>
<li><a class="post-link" href="/tech-blog/2017/09/08/typescript-notes-part-1.html" title="Key Points To Architecturing Cloud Applications, Part 4: Reliability">TypeScript Notes: Part 1</a></li>
<li><a class="post-link" href="/tech-blog/2009/04/08/net-2-0-notes-on-foundation-part-5-c.html" title="Key Points To Architecturing Cloud Applications, Part 4: Reliability">.NET 2.0: Notes on Foundation Part 5 (C#)</a></li>
<li><a class="post-link" href="/tech-blog/2014/05/14/using-css-media-queries.html" title="Key Points To Architecturing Cloud Applications, Part 4: Reliability">Using CSS Media Queries</a></li>
</ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/tech-blog/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div></div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/tech-blog/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
